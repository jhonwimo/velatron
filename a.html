<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Velatron vs Osos ‚Äî Juego</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    touch-action: none; /* Deshabilita el zoom y scroll t√°ctil */
  }

  body {
    background: linear-gradient(180deg,#071026,#0b1220); /* Fondo degradado azul oscuro para el body */
    font-family: Inter, Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  canvas {
    width: 100vw !important;  /* El canvas ocupa todo el ancho de la ventana */
    height: 100vh !important; /* El canvas ocupa todo el alto de la ventana */
    display: block;
    background: transparent; /* Transparente para ver el fondo del body */
  }

  #hud {
    position: fixed;
    top: 10px;
    left: 12px;
    color: white;
    font-size: 18px; /* Tama√±o fijo, considera vw si quieres que escale con la pantalla */
    z-index: 10;
  }

  /* Personalizaci√≥n de SweetAlert2 tema Velatron */
  .swal2-popup {
    background: linear-gradient(135deg, #0b1220 0%, #071026 50%, #102033 100%) !important;
    border: 2px solid #00ffff !important;
    border-radius: 15px !important;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.5), inset 0 0 20px rgba(0, 100, 150, 0.3) !important;
  }

  .swal2-title {
    color: #00ffff !important;
    font-family: 'Inter', Arial, sans-serif !important;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.8) !important;
    font-weight: bold !important;
  }

  /* Estilo para el t√≠tulo de la intro tipo cine */
  .swal2-laser-title {
    font-size: 2.8em !important; /* M√°s grande para el efecto de cine */
    font-weight: 900 !important;
    text-transform: uppercase !important;
    letter-spacing: 2px !important;
    background: linear-gradient(90deg, #00ffff, #0080ff, #00ffff) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    text-shadow: 0 0 15px rgba(0, 255, 255, 0.9), 0 0 30px rgba(0, 255, 255, 0.7) !important;
    animation: pulseGlow 1.5s infinite alternate !important; /* Animaci√≥n de brillo */
  }

  @keyframes pulseGlow {
    from {
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.7), 0 0 20px rgba(0, 255, 255, 0.5);
    }
    to {
      text-shadow: 0 0 20px rgba(0, 255, 255, 0.9), 0 0 40px rgba(0, 255, 255, 0.7);
    }
  }


  .swal2-html-container {
    color: #ffffff !important;
    font-family: 'Inter', Arial, sans-serif !important;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5) !important;
  }

  .swal2-confirm {
    background: linear-gradient(45deg, #00ffff, #0080ff) !important;
    border: none !important;
    border-radius: 12px !important;
    color: #000 !important;
    font-weight: bold !important;
    font-size: 18px !important;
    padding: 15px 30px !important;
    min-width: 200px !important;
    min-height: 50px !important;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.6) !important;
    transition: all 0.3s ease !important;
    margin: 10px !important;
  }

  .swal2-confirm:hover {
    background: linear-gradient(45deg, #0080ff, #00ffff) !important;
    box-shadow: 0 0 25px rgba(0, 255, 255, 0.8) !important;
    transform: scale(1.05) !important;
  }

  .swal2-cancel {
    background: linear-gradient(45deg, #ff4444, #cc0000) !important;
    border: none !important;
    border-radius: 12px !important;
    color: #fff !important;
    font-weight: bold !important;
    font-size: 18px !important;
    padding: 15px 30px !important;
    min-width: 200px !important;
    min-height: 50px !important;
    box-shadow: 0 0 15px rgba(255, 68, 68, 0.6) !important;
    margin: 10px !important;
  }

  .swal2-cancel:hover {
    background: linear-gradient(45deg, #cc0000, #ff4444) !important;
    box-shadow: 0 0 25px rgba(255, 68, 68, 0.8) !important;
    transform: scale(1.05) !important;
  }

  /* Botones m√°s grandes en dispositivos m√≥viles */
  @media (max-width: 768px) {
    .swal2-confirm, .swal2-cancel {
      font-size: 20px !important;
      padding: 18px 35px !important;
      min-width: 250px !important;
      min-height: 60px !important;
      margin: 15px !important;
    }
    
    .swal2-actions {
      flex-direction: column !important;
      gap: 10px !important;
    }
  }

  /* Botones extra grandes para pantallas muy peque√±as */
  @media (max-width: 480px) {
    .swal2-confirm, .swal2-cancel {
      font-size: 24px !important;
      padding: 22px 45px !important;
      min-width: 320px !important;
      min-height: 70px !important;
      margin: 18px 5px !important;
      letter-spacing: 1px !important;
      font-weight: 900 !important;
    }
    
    .swal2-popup {
      padding: 25px !important;
    }
  }
</style>
</head>

<body onload="resizeCanvas()" onresize="resizeCanvas()">

<div id="hud">Puntos: 0 ¬∑ Vidas: 3 ¬∑ üöÄ ESPACIO: L√°ser ¬∑ üó°Ô∏è Z: Sable</div>
<canvas id="game"></canvas>

<script>
/* ---------------- Canvas ---------------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const hud = document.getElementById("hud");

// Redimensiona el canvas y actualiza WIDTH/HEIGHT
function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  WIDTH = canvas.width;
  HEIGHT = canvas.height;
  
  // --- AJUSTES RESPONSIVOS ---
  // Jugador
  const playerScaleFactor = 0.18; // 18% del ancho de la pantalla para el jugador
  player.w = WIDTH * playerScaleFactor; 
  player.h = player.w; // Mantener aspecto cuadrado (si la imagen es cuadrada)
  player.y = HEIGHT - player.h - (HEIGHT * 0.10); // 10% de la altura desde abajo para el jugador
  player.x = WIDTH / 2 - player.w / 2; // Reposicionar jugador en el centro al redimensionar
  player.speed = (WIDTH / 1920) * 10; // Velocidad base 10 a 1920px de ancho

  // Osos
  const osoDisplayWidthFactor = 0.35; // Osos ocupar√°n un 35% del ancho de la pantalla
  
  bears.forEach(b => {
    b.w = WIDTH * osoDisplayWidthFactor;
    // La altura se calcula manteniendo el aspect ratio del frame del spritesheet
    if (osoFrameWidth > 0 && osoFrameHeight > 0) { // Asegurarse de que las dimensiones del frame ya est√©n cargadas
        b.h = b.w * (osoFrameHeight / osoFrameWidth); 
    } else { // Si no est√°n cargadas, usar un fallback temporal o esperar
        b.h = b.w; // Asumir cuadrado hasta que la imagen cargue
    }
    b.speed = (HEIGHT / 800) * (b.initialSpeedFactor); // Reajustar velocidad del oso
  });
  
  lasers.forEach(l => {
    l.speed = (HEIGHT / 800) * 12; // Base speed 12 at 800px height
    l.w = WIDTH * 0.008; // Ancho del l√°ser escalado
    l.h = HEIGHT * 0.04; // Altura del l√°ser escalada
  });

  // Reajustar posici√≥n de los l√°seres si ya existen para evitar "saltos"
  // Esto puede ser complejo si los l√°seres ya est√°n muy lejos.
  // Podr√≠a ser mejor recalcular su posici√≥n relativa.
}
resizeCanvas(); // Llamar al inicio para establecer los valores iniciales

/* ---------------- Estado ---------------- */
let WIDTH = canvas.width;
let HEIGHT = canvas.height;

let running = false; // El juego no corre al inicio
let score = 0;
let lives = 3;
let lastTime = 0;
let lastBearId = 0; // Para dar un ID √∫nico a cada oso

/* ---------------- Im√°genes y Spritesheets ---------------- */
const playerImg = new Image();
playerImg.src = "velatron.png"; // Aseg√∫rate de tener este archivo tambi√©n

const osoSpriteSheetImg = new Image();
osoSpriteSheetImg.src = "oso.png"; // ¬°Este es el spritesheet de los osos con animaci√≥n!

// Dimensiones de cada fotograma individual del oso dentro del spritesheet
// Basado en tu descripci√≥n: "cada 'fila' vertical contiene dos osos lado a lado"
const osoNumCols = 2; // Hay 2 osos horizontalmente en cada "fila" visual del spritesheet
let osoNumRows = 8; // **ASUME 8 FILAS DE DUETOS**. ¬°AJUSTA ESTO SI TU SPRITESHEET TIENE M√ÅS O MENOS!
let osoFrameWidth = 0; // Se calcular√° cuando la imagen cargue
let osoFrameHeight = 0; // Se calcular√° cuando la imagen cargue

// Cada oso individual tiene 'osoNumRows' frames de animaci√≥n para su ciclo completo
let numOsoFrames = osoNumRows; 

// Velocidad de animaci√≥n del oso (ms por fotograma)
const osoAnimationSpeed = 100; // Cada fotograma cambia cada 100ms

osoSpriteSheetImg.onload = () => {
    // Calcula las dimensiones del frame una vez que la imagen se carga
    osoFrameWidth = osoSpriteSheetImg.width / osoNumCols;
    osoFrameHeight = osoSpriteSheetImg.height / osoNumRows;
    // Despu√©s de cargar el spritesheet y calcular las dimensiones del frame,
    // es un buen momento para llamar a resizeCanvas() de nuevo para que los osos
    // existentes (si los hubiera) ajusten su tama√±o correctamente al aspect ratio del frame.
    resizeCanvas(); 
};

/* ---------------- Audio ---------------- */
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
let audioInitialized = false;

// Funci√≥n para crear sonidos sint√©ticos
function createTone(frequency, duration, type = 'sine', volume = 0.3) {
  if (!audioInitialized) return;
  
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
  oscillator.type = type;
  
  gainNode.gain.setValueAtTime(0, audioContext.currentTime);
  gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
  gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
  
  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + duration);
}

// Sonidos del juego
function playLaserSound() {
  createTone(800, 0.15, 'sawtooth', 0.2);
  setTimeout(() => createTone(1200, 0.1, 'sine', 0.15), 50);
}

function playSwordSound() {
  createTone(400, 0.2, 'square', 0.25);
  setTimeout(() => createTone(600, 0.15, 'sawtooth', 0.2), 80);
}

function playExplosionSound() {
  // Explosi√≥n con ruido blanco
  if (!audioInitialized) return;
  
  const bufferSize = audioContext.sampleRate * 0.3;
  const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
  const output = buffer.getChannelData(0);
  
  for (let i = 0; i < bufferSize; i++) {
    output[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / bufferSize, 2);
  }
  
  const source = audioContext.createBufferSource();
  const gainNode = audioContext.createGain();
  
  source.buffer = buffer;
  source.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
  
  source.start();
}

function playHitSound() {
  createTone(200, 0.3, 'sawtooth', 0.3);
  setTimeout(() => createTone(150, 0.2, 'triangle', 0.25), 100);
}

// Inicializar audio en la primera interacci√≥n
function initAudio() {
  if (audioInitialized) return;
  if (audioContext.state === 'suspended') {
    audioContext.resume();
  }
  audioInitialized = true;
}

/* ---------------- Alertas Velatron ---------------- */
function showGameIntro() {
  Swal.fire({
    title: '<span class="swal2-laser-title">Velatron vs Osos</span>', // T√≠tulo con estilo "laser"
    html: `
      <div style="text-align: center; margin-top: 20px;">
        <div style="font-size: 1.1em; opacity: 0.9; margin: 10px 0;">
          Una galaxia al borde del caos. Una amenaza peluda emerge de las sombras...
        </div>
        <div style="font-size: 1.3em; color: #00ffff; font-weight: bold; margin: 20px 0;">
          ¬øEst√°s listo para empu√±ar el sable y defender la paz?
        </div>
      </div>
    `,
    icon: 'question', 
    iconColor: '#00ffff',
    showCancelButton: true,
    confirmButtonText: '‚ö° INICIAR MISI√ìN', 
    cancelButtonText: '‚ùå ABANDONAR GALAXY',
    allowOutsideClick: false,
    allowEscapeKey: false,
    backdrop: 'rgba(0, 0, 0, 0.8)'
  }).then((result) => {
    if (result.isConfirmed) {
      running = true; // Iniciar el bucle del juego
      initAudio(); // Asegurar que el audio se inicialice al iniciar el juego
    } else {
      window.close(); // Cierra la pesta√±a si el usuario abandona
    }
  });
}

function showGameOver(finalScore) {
  Swal.fire({
    title: '‚ö° GAME OVER ‚ö°',
    html: `
      <div style="text-align: center;">
        <div style="font-size: 1.2em; margin: